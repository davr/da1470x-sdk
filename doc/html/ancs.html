<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SmartSnippets DA1470x SDK: BLE ANCS Client demo application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1470x SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">BLE ANCS Client demo application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md132"></a>
Overview</h1>
<p>This application is a sample implementation for Apple Notification Center Service (ANCS) client. It supports all the features of the Notification Consumer (NC) role provided by this service.</p>
<h1><a class="anchor" id="autotoc_md133"></a>
Installation procedure</h1>
<p>The project is located in the <b><code>projects/dk_apps/ble_profiles/ancs</code></b> folder.</p>
<p>To install the project follow the <a class="el" href="install_and_debug_procedure.html">General Installation and Debugging Procedure</a>.</p>
<h1><a class="anchor" id="autotoc_md134"></a>
Suggested configurable parameters</h1>
<h2><a class="anchor" id="autotoc_md135"></a>
Drop preexisting notifications</h2>
<p>Upon connection the iOS device sends all pending notifications. By default, all of them are dropped by the application and only notifications generated after the connection are processed. To also process the notification events that were generated before the connection, set the following configuration macro to 0.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CFG_DROP_PREEXISTING_NOTIFICATIONS      (1)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md136"></a>
Verbose logging</h2>
<p>By default, the application will only print incoming notifications once all the data is received (attributes, application). Verbose logging will enable more printouts for intermediate steps as they are being executed, i.e. received notification information, reading attributes etc.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CFG_VERBOSE_LOG (0)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md137"></a>
Maximum length for "title" and "message" attributes</h2>
<p>This configures the maximum number of received characters for the notification attributes "title" and "message". It affects what is displayed as notification content.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CFG_TITLE_ATTRIBUTE_MAXLEN      (25)</span></div>
<div class="line"><span class="preprocessor">#define CFG_MESSAGE_ATTRIBUTE_MAXLEN    (75)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md138"></a>
GPIO for K1 button</h2>
<p>K1 button is used to trigger performing negative action on most recently received notification. See section 'Manuual testing' for details.</p>
<p>Default value is suitable when running on ProDK rev. B and C for DA1468x or ProDK rev. A for DA1469x or ProDK for DA1470x and GPIO's are defined during preprocessing.</p>
<div class="fragment"><div class="line"> {sdk/config/boards/brd_prodk_da1469x.h}</div>
<div class="line">/* KEY configuration section */</div>
<div class="line">#define KEY1_PORT       (HW_GPIO_PORT_0)</div>
<div class="line">#define KEY1_PIN        (HW_GPIO_PIN_6)</div>
<div class="line">#define KEY1_MODE       (HW_GPIO_MODE_INPUT_PULLUP)</div>
<div class="line">#define KEY1_FUNC       (HW_GPIO_FUNC_GPIO)</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {sdk/config/boards/brd_prodk_da14680.h}</div>
<div class="line">/* KEY configuration section */</div>
<div class="line">#define KEY1_PORT       (HW_GPIO_PORT_1)</div>
<div class="line">#define KEY1_PIN        (HW_GPIO_PIN_6)</div>
<div class="line">#define KEY1_MODE       (HW_GPIO_MODE_INPUT_PULLUP)</div>
<div class="line">#define KEY1_FUNC       (HW_GPIO_FUNC_GPIO)</div>
</div><!-- fragment --><div class="fragment"><div class="line"> {sdk/config/boards/brd_prodk_da1470x.h}</div>
<div class="line">/* KEY configuration section */</div>
<div class="line">#define KEY1_PORT       (HW_GPIO_PORT_1)</div>
<div class="line">#define KEY1_PIN        (HW_GPIO_PIN_22)</div>
<div class="line">#define KEY1_MODE       (HW_GPIO_MODE_INPUT_PULLUP)</div>
<div class="line">#define KEY1_FUNC       (HW_GPIO_FUNC_GPIO)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md139"></a>
GPIO for K2 button (DA1470X only)</h2>
<p>K2 button is used to trigger performing positive action on most recently received notification.</p>
<p>Default value is suitable when running on ProDK for DA1470x and GPIO's are defined during preprocessing.</p>
<div class="fragment"><div class="line"> {sdk/config/boards/brd_prodk_da1470x.h}</div>
<div class="line">/* KEY configuration section */</div>
<div class="line">#define KEY2_PORT       (HW_GPIO_PORT_1)</div>
<div class="line">#define KEY2_PIN        (HW_GPIO_PIN_23)</div>
<div class="line">#define KEY2_MODE       (HW_GPIO_MODE_INPUT_PULLUP)</div>
<div class="line">#define KEY2_FUNC       (HW_GPIO_FUNC_GPIO)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md140"></a>
Request timeout</h2>
<p>Requests (either application or notification attributes) which take too long will be cancelled automatically after specified time.</p>
<p>Default value is 10 seconds.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CFG_REQUEST_TIMEOUT_MS  (10000)</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md141"></a>
Browse delay</h2>
<p>A short delay is used before starting to browse for ANCS.</p>
<p>Default value is 1 second.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define CFG_BROWSE_DELAY_MS  (1000)</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md142"></a>
Manual testing</h1>
<p>The application runs as Notification Consumer, thus it uses LE Peripheral role when started and starts advertising. Advertising data contains Service Solicitation UUID for ANCS as defined by specification (<em>7905f431-b5ce-4e99-a40f-4b1e122d00d0</em>) and device name (<em>Dialog ANCS Demo</em>) is located in scan response.</p>
<p>Debug logs are output using serial port available when plafrom is connected to PC using USB2 connector (e.g. <code>/dev/ttyUSB0</code>).</p>
<ol type="1">
<li>Use iOS device for scan for devices and connect to <em>Dialog ANCS Demo</em>.</li>
<li>Due to security requirements of ANCS pairing will be triggered and should be accepted.</li>
<li>Once connected, any notification which already exist on iOS device will be retrieved and printed in logs.</li>
<li>Any new notification on iOS device will be retrieved and printed in logs from now on. Notifications can be created using various apps like Mail, Reminders, Calendars and many others.</li>
<li>K1 button can be used to perform so-called negative action on most recently received notification. This usually means that notification will be removed, but it depends on contents of notification.</li>
</ol>
<p>Notification is printed in following form:</p>
<div class="fragment"><div class="line">Notification from Reminders (com.apple.reminders)</div>
<div class="line">        Category: Schedule</div>
<div class="line">            Date: 20160127T125500</div>
<div class="line">           Title: Reminder</div>
<div class="line">         Message: sample reminder</div>
</div><!-- fragment --><p>All data is printed as received from iOS device, no additional processing is applied.</p>
<p>If verbose logging is enabled, some additional information will be also printed like "raw" events received from iOS device.</p>
<h1><a class="anchor" id="autotoc_md143"></a>
Known limitations</h1>
<p>MTU values, connection parameters and device name are hardcoded at the moment, they can only be modified by making changes in source code. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 9 2022 13:50:40 for SmartSnippets DA1470x SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
