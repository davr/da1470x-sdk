<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SmartSnippets DA1470x SDK: Heart Rate collector demo application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1470x SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Heart Rate collector demo application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md195"></a>
Overview</h1>
<p>This application is a sample implementation of Heart Rate collector as defined by HRP specification 1.0. All features are supported (i.e. both mandatory and optional features).</p>
<p>The application is controlled using command line interface exposed over UART2.</p>
<p>The application supports up to 8 simultaneous connections.</p>
<h1><a class="anchor" id="autotoc_md196"></a>
Installation procedure</h1>
<p>The project is located in the <b><code>projects/dk_apps/ble_profiles/hrp_collector</code></b> folder.</p>
<p>To install the project follow the <a class="el" href="install_and_debug_procedure.html">General Installation and Debugging Procedure</a>.</p>
<h1><a class="anchor" id="autotoc_md197"></a>
Suggested Configurable parameters</h1>
<h1><a class="anchor" id="autotoc_md198"></a>
Manual testing</h1>
<p>The application is controlled using command line interface (CLI) which can be accessed using serial port available when platform is connected to PC using USB2 connector (e.g. <b><code>/dev/ttyUSBx</code></b> or <b><code>COMx</code></b>).</p>
<h2><a class="anchor" id="autotoc_md199"></a>
Quick start</h2>
<p>To quickly scan and connect to sensor device:</p>
<ol type="1">
<li>Type <b><code>scan start</code></b> to start scanning for HRP Sensor devices.</li>
<li>When device is found, type <b><code>scan stop</code></b> to stop scanning. <div class="fragment"><div class="line">Scanning...</div>
<div class="line">[01] Device found: public C3:26:2B:63:B1:11 (Wahoo HRM v2.1)</div>
<div class="line">Scan stopped</div>
</div><!-- fragment --></li>
<li>Now you can connect to a device by using one of following methods:<ul>
<li>type <b><code>connect 1</code></b> to connect to 1st device found</li>
<li>type <b><code>connect C3:26:2B:63:B1:11</code></b> to connect to device with given address</li>
</ul>
</li>
<li><p class="startli">The connection is established and device is automatically discovered:</p>
<dl class="section note"><dt>Note</dt><dd>The collector stores services of bonded sensors. Any subsequent connection to already bonded sensor will not generate additional GATT traffic. The sensor information is to be read from storage. During first connection bonding will not start automatically. Application verifies bond status on reconnection, thus any lose of encryption keys information will trigger pairing procedure and re-discovery of all services.</dd></dl>
<div class="fragment"><div class="line">Connecting to C3:26:2B:63:B1:11 ...</div>
<div class="line">Device connected</div>
<div class="line">        Address: public C3:26:2B:63:B1:11</div>
<div class="line">        Connection index: 0</div>
<div class="line">Security level changed</div>
<div class="line">        Connection index: 0</div>
<div class="line">        Security level: 2</div>
<div class="line">Browsing...</div>
<div class="line">Pairing completed</div>
<div class="line">        Connection index: 0</div>
<div class="line">        Status: 0x00</div>
<div class="line">        Bond: 1</div>
<div class="line">        MITM: 0</div>
<div class="line">Browse completed</div>
<div class="line">        Heart Rate service found</div>
<div class="line">        Device Information Service found</div>
<div class="line">Querying device...</div>
<div class="line">        Manufacturer: Wahoo Fitness</div>
<div class="line">        Body Sensor Location: chest</div>
<div class="line">        Firmware version: 2.1</div>
<div class="line">Heart Rate Measurement notifications enabled</div>
<div class="line">Ready.</div>
</div><!-- fragment --><p> As can be seen above, discovery includes following actions:</p><ul>
<li>search for Device Information Service and read available characteristics,</li>
<li>search for Heart Rate Service and read available characteristics, e.g. sensor location,</li>
<li>enable notifications for measurement characteristic.</li>
</ul>
</li>
<li>Initialization is finished when <b><code>Ready.</code></b> message is received, as above. You should see incoming measurement notifications as below. <div class="fragment"><div class="line">Heart Rate Measurement notification received</div>
<div class="line">        Value: 67 bpm</div>
<div class="line">        Sensor Contact: supported, not detected</div>
<div class="line">        RR-Intervals: 918 932</div>
<div class="line"> </div>
<div class="line">Heart Rate Measurement notification received</div>
<div class="line">        Value: 67 bpm</div>
<div class="line">        Sensor Contact: supported, not detected</div>
<div class="line">        RR-Intervals: 935</div>
</div><!-- fragment --></li>
<li>To use full functionality of the application, check the complete list of commands below.</li>
</ol>
<h2><a class="anchor" id="autotoc_md200"></a>
Available commands</h2>
<h3><a class="anchor" id="autotoc_md201"></a>
&lt;tt&gt;scan &lt;start|stop&gt; [any]&lt;/tt&gt;</h3>
<p>Start and stop scanning procedure.</p>
<p>By default, the application scans for devices which include Heart Rate service UUID (0x180D) in advertising data. To scan for any device in range use optional <b><code>any</code></b> parameter, i.e. <b><code>scan start any</code></b>.</p>
<p>The returned list of devices includes an index, a device address and a device name (if available).</p>
<dl class="section note"><dt>Note</dt><dd>The application can cache up to 25 devices. When this limit is reached, application stops filtering duplicated devices and any new devices found are reported with index <code>00</code>.</dd></dl>
<h3><a class="anchor" id="autotoc_md202"></a>
&lt;tt&gt;connect &lt;address [public|private] | index&gt;&lt;/tt&gt;</h3>
<p>Connect to peripheral device.</p>
<p>The device can be specified by either providing an address or an index of device found during last scan session.</p>
<p>The optional address type applies only when connecting to a device using an address. If not specified, the address type is searched on results from previous scan session or <b><code>public</code></b> is used when not available.</p>
<h3><a class="anchor" id="autotoc_md203"></a>
&lt;tt&gt;connect cancel&lt;/tt&gt;</h3>
<p>Cancel ongoing connection attempt.</p>
<div class="fragment"><div class="line">Connection completed</div>
<div class="line">        Status: 0x0c</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md204"></a>
&lt;tt&gt;notifications &lt;conn_idx&gt; &lt;on|off&gt;&lt;/tt&gt;</h3>
<p>Enable and disable Heart Rate Measurement notifications on device with specified <code>&lt;conn_idx&gt;</code>.</p>
<p>This command is provided for debugging purposes. Notifications are always enabled after sensor is connected and there is no need to enable them explicitly.</p>
<h3><a class="anchor" id="autotoc_md205"></a>
&lt;tt&gt;disconnect [&lt;conn_idx&gt;]&lt;/tt&gt;</h3>
<p>Disconnect sensor with specified <code>&lt;conn_idx&gt;</code>. If <code>&lt;conn_idx&gt;</code> is not specified disconnect with first sensor on list of connected devices</p>
<dl class="section note"><dt>Note</dt><dd>To see that list use command: <code>show connected</code>.</dd></dl>
<div class="fragment"><div class="line">Disconnected from C3:26:2B:63:B1:11</div>
<div class="line">Device disconnected</div>
<div class="line">        Connection index: 0</div>
<div class="line">        Reason: 0x16</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md206"></a>
&lt;tt&gt;reset_ee &lt;conn_idx&gt;&lt;/tt&gt;</h3>
<p>Reset energy expended value</p>
<dl class="section note"><dt>Note</dt><dd>Support for this command depends on capabilities of the sensor device since support for this features is optional as per HRP specification.</dd></dl>
<h3><a class="anchor" id="autotoc_md207"></a>
&lt;tt&gt;show [connected|bonded]&lt;/tt&gt;</h3>
<p>Show list of connected/bonded sensors</p>
<h3><a class="anchor" id="autotoc_md208"></a>
&lt;tt&gt;unbond [[public|private] &lt;address&gt; | all]&lt;/tt&gt;</h3>
<p>Unbond sensor with specified address or unbond all bonded sensors</p>
<dl class="section note"><dt>Note</dt><dd>Write <code>show bonded</code> to see list of bonded sensors to unbond </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 9 2022 13:50:40 for SmartSnippets DA1470x SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
