<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SmartSnippets DA1470x SDK: Apple Media Service demo application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1470x SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Apple Media Service demo application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md119"></a>
Overview</h1>
<p>This application is a sample implementation of the Apple Media Service (AMS) service client - Media Remote role defined in the AMS Profile Specification. The demo supports all optional characteristics of AMS - Remote Command, Entity Update and Entity Attribute.</p>
<h1><a class="anchor" id="autotoc_md120"></a>
Installation procedure</h1>
<p>The project is located in the <b><code>projects/dk_apps/ble_profiles/ams</code></b> folder.</p>
<p>To install the project follow the <a class="el" href="install_and_debug_procedure.html">General Installation and Debugging Procedure</a>.</p>
<h2><a class="anchor" id="autotoc_md121"></a>
UART configuration</h2>
<p>The application can be controlled using the serial console exposed over UART2.</p>
<p>GPIO pins configuration is as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">DA1470x GPIO pin  </th><th class="markdownTableHeadNone">DA1469x GPIO pin  </th><th class="markdownTableHeadNone">DA1468x GPIO pin  </th><th class="markdownTableHeadNone">Function   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">P0.8  </td><td class="markdownTableBodyNone">P0.9  </td><td class="markdownTableBodyNone">P1.3  </td><td class="markdownTableBodyNone">UART2 TX   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">P1.2  </td><td class="markdownTableBodyNone">P0.8  </td><td class="markdownTableBodyNone">P2.3  </td><td class="markdownTableBodyNone">UART2 RX   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">P0.11  </td><td class="markdownTableBodyNone">P0.7  </td><td class="markdownTableBodyNone">P1.6  </td><td class="markdownTableBodyNone">UART2 CTS   </td></tr>
</table>
<p>UART settings are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Setting  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Baudrate  </td><td class="markdownTableBodyNone">115200   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Data bits  </td><td class="markdownTableBodyNone">8   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Stop bits  </td><td class="markdownTableBodyNone">1   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Parity  </td><td class="markdownTableBodyNone">None   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flow control  </td><td class="markdownTableBodyNone">RTS/CTS   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md122"></a>
LED configuration</h2>
<p>The application sets the LED active when playing. Otherwise the LED is turned off. The LED is connected to P1.5 on the DA1468x platform (jumper J5 must be connected), to P1.1 on the DA1469x platform (P1.1 is connected to the RED led on the daughterboard) and to LED2 on the DA1470x platform (LED2 is connected to the RED led on the daughterboard).</p>
<h2><a class="anchor" id="autotoc_md123"></a>
BUTTON configuration</h2>
<p>The application uses a button to trigger PLAY/PAUSE command. The button is also used to unpair all devices at startup - user may simply keep the button pressed during reboot. If there is any bonded device, the following message will be printed on the console (in this example C4:61:8B:80:2B:5E device is in cache): </p><div class="fragment"><div class="line">Unpairing C4:61:8B:80:2B:5E</div>
<div class="line">Start advertising...</div>
</div><!-- fragment --><p>The button is connected to P1.2 on the DA1468x platform (a connection between J8 connector's first pin and P1.2 pin is needed), to P0.6 on the DA1469x platform (J8 jumper must be connected) and to P1.22 on the DA1470x platform (J35 jumper must be connected - on the 1 and 2 pin).</p>
<h1><a class="anchor" id="autotoc_md124"></a>
Suggested Configurable parameters</h1>
<h2><a class="anchor" id="autotoc_md125"></a>
Verbose logs</h2>
<p>To enable verbose logs containing all data coming from the AMS, set CFG_VERBOSE_LOG in ams_config.h file to a non-zero value, i.e.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#       define CFG_VERBOSE_LOG (1)</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md126"></a>
Manual testing</h1>
<p>The application is controlled using command line interface (CLI) which can be accessed using the serial port available when the platform is connected to a PC using USB connector (e.g. <code>/dev/ttyUSBx</code> or <code>COMx</code>).</p>
<h2><a class="anchor" id="autotoc_md127"></a>
Quick start</h2>
<p>Use a device that supports AMS service, scan for the "Dialog AMS Demo" device and connect to it. </p><div class="fragment"><div class="line">Device connected</div>
<div class="line">Browsing...</div>
<div class="line">Browse completed</div>
<div class="line">GATT: found</div>
<div class="line">AMS: found</div>
<div class="line">Security level changed (level: 2)</div>
<div class="line">Ready.</div>
</div><!-- fragment --><p>Notifications from Entity Update are displayed in human-readable form as follows: </p><div class="fragment"><div class="line">Remote commands update</div>
<div class="line">Artist: Some Artist</div>
<div class="line">Duration: 384.113</div>
<div class="line">Title: Some Title</div>
</div><!-- fragment --><ol type="1">
<li>To use full functionality of the application, check the complete list of commands below.</li>
</ol>
<h2><a class="anchor" id="autotoc_md128"></a>
Available commands</h2>
<h3><a class="anchor" id="autotoc_md129"></a>
&lt;tt&gt;cmd &lt;remote_command&gt;&lt;/tt&gt;</h3>
<p>Send remote command</p>
<p>It will send a remote command to the AMS Media Source. Remote commands are defined in the AMS Profile Specification, i.e.: </p><div class="fragment"><div class="line">cmd 2</div>
<div class="line">Remote command</div>
<div class="line">    Remote command 0x02 sent</div>
<div class="line">Playback state: Paused</div>
</div><!-- fragment --><p> Will send a RemoteCommandIDTogglePlayPause command.</p>
<h3><a class="anchor" id="autotoc_md130"></a>
&lt;tt&gt;fetch &lt;entity_id&gt; &lt;attribute_id&gt;&lt;/tt&gt;</h3>
<p>This command allows the user to read the content of a given attribute. I.e. if the negotiated MTU was not large enough to send Track Name in the Entity Update notification, it can be fetched using the command below: </p><div class="fragment"><div class="line">fetch 2 2</div>
<div class="line">Fetch attribute</div>
<div class="line">    Pushed to attribute requests queue</div>
<div class="line">Title: Example Title</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Not all attributes may be exposed by Entity Attribute. It depends on the capabilities of the active player.</dd></dl>
<h2><a class="anchor" id="autotoc_md131"></a>
Verbose Logs Output</h2>
<p>Enabling verbose logs allow the user to see more detailed information about notifications coming from iOS. Entity Update notifications are decoded as follows:</p>
<div class="fragment"><div class="line">Entity Update</div>
<div class="line">    Entity ID: EntityIDTrack (0x02)</div>
<div class="line">    Attribute ID: TrackAttributeIDDuration (0x03)</div>
<div class="line">    Flags: (0x00)</div>
<div class="line">    Value: 291.527</div>
</div><!-- fragment --><p>Read from Entity Attribute:</p>
<div class="fragment"><div class="line">Entity Attribute Read Completed</div>
<div class="line">    Entity ID: EntityIDPlayer (0x00)</div>
<div class="line">    Attribute ID: PlayerAttributeIDName (0x00)</div>
<div class="line">    Value: SomePlayerName</div>
</div><!-- fragment --><p>Remote Command notifications:</p>
<div class="fragment"><div class="line">Remote commands update</div>
<div class="line">    Number of supported commands: 0x0E</div>
<div class="line">    Commands:</div>
<div class="line">        RemoteCommandIDPlay (0x00)</div>
<div class="line">        RemoteCommandIDPause (0x01)</div>
<div class="line">        RemoteCommandIDTogglePlayPause (0x02)</div>
<div class="line">        RemoteCommandIDNextTrack (0x03)</div>
<div class="line">        RemoteCommandIDPreviousTrack (0x04)</div>
<div class="line">        RemoteCommandIDVolumeUp (0x05)</div>
<div class="line">        RemoteCommandIDVolumeDown (0x06)</div>
<div class="line">        RemoteCommandIDAdvanceRepeatMode (0x07)</div>
<div class="line">        RemoteCommandIDAdvanceShuffleMode (0x08)</div>
<div class="line">        RemoteCommandIDSkipForward (0x09)</div>
<div class="line">        RemoteCommandIDSkipBackward (0x0A)</div>
<div class="line">        RemoteCommandIDLikeTrack (0x0B)</div>
<div class="line">        RemoteCommandIDDislikeTrack (0x0C)</div>
<div class="line">        RemoteCommandIDBookmarkTrack (0x0D)</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 9 2022 13:50:40 for SmartSnippets DA1470x SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
