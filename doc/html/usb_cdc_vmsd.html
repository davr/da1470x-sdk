<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SmartSnippets DA1470x SDK: USB CDC and Virtual MSD application</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1470x SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">USB CDC and Virtual MSD application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md311"></a>
Overview</h1>
<p>This application is an example app about how to implement USB CDC and VirtualMSD multi-interface USB-Device.</p>
<h1><a class="anchor" id="autotoc_md312"></a>
VirtualMSD information</h1>
<p>VirtualMSD is used as a wrapper for handling files without implementing the full MSD functionality through VirtualMSD's abstraction layer by retrieving and manipulating the content of specific files without the need to implement a filesystem in the device. VirtualMSD is not a replacement of the MSD, just a wrapper on top of the MSD. MSD functionality and API is also available with VMSD on the created volume.</p>
<p><b>Notes:</b></p><ul>
<li>New files created are properly passed through the _cbOnWrite() and _cbOnRead() enabling the application to save their content and retrieve it from permanent storage locations or redirect the contents through services while the device is plugged.</li>
<li>Constant files can be used to extract information from the device by adding dynamically a constant file in the array of constant files with the pData = NULL and the FileSize=&lt;size to return to host&gt; in the USB_VMSD_CONST_FILE array of constant files before the enumeration.</li>
<li>For dynamic addition of constant files, the application should add the entries in the USB_VMSD_CONST_FILE array of constant files and then call the USBD_VMSD_ReInit(); to re-initialize the Virtual Storage area.</li>
<li>To have generic storage capabilities and store any file in the device, use the MSD class. In this case it is suggested to use the NVMS as low level medium access interface and a FAT-FS implementation for accessing the files in the the device's storage for this purpose.</li>
</ul>
<p>For details on the use of the VirtualMSD and MSD please refer to SEGGER documentation and SEGGER support for the emUSB-Device USB stack at <a href="https://www.segger.com/emusb.html">https://www.segger.com/emusb.html</a> </p>
<h1><a class="anchor" id="autotoc_md313"></a>
USB feature</h1>
<ul>
<li>To enable the USB-Data functionality it is mandatory to define the next macro in custo configuration header: <div class="fragment"><div class="line"><span class="preprocessor">#define dg_configUSE_USB_ENUMERATION 1</span></div>
</div><!-- fragment --></li>
<li>To enable the USB-Data over DMA the channels and priorities must be configured and the respective configuration option must be switched on in the custom configuration header: <div class="fragment"><div class="line"><span class="preprocessor">#define dg_configUSB_DMA_SUPPORT 1</span></div>
</div><!-- fragment --></li>
<li>The USB stack framework included in the SDK is the Segger emUSB-Device. Please refer to SEGGER emUSB documentation for more information at link: <a href="https://www.segger.com/emusb.html">https://www.segger.com/emusb.html</a></li>
</ul>
<p><b>Notes:</b></p><ul>
<li>The charger functionality is also enabled along with the USB-Data functionality. This is controlled through the following macro in the custom configuration header: <div class="fragment"><div class="line"><span class="preprocessor">#define dg_configUSE_SYS_CHARGER 1</span></div>
</div><!-- fragment --></li>
<li>The emUSB stack framework is provided in object code in the 'sdk/interfaces/usb' library. It is required the library to be included in the project to be able to build the project with USB-Data functionality.</li>
<li>The emUSB stack framework is NOT needed for USB-Charger only functionality.</li>
</ul>
<h1><a class="anchor" id="autotoc_md314"></a>
Configurable parameters</h1>
<ul>
<li>The default values for usb PID/VID can be used during development period. It should be changed to your company's values.<ul>
<li>USB PID/VID and com port name in usb_cdc_vmsd.c.</li>
<li>Windows driver(dialog_usb.inf).</li>
</ul>
</li>
<li>VirtualMSD is an emulated FAT file system. The data will be stored to FLASH if the following macro (in usb_cdc_vmsd.c) is defined, otherwise they will be stored in RAM. <div class="fragment"><div class="line"><span class="preprocessor">#define VMSD_USE_NVMS</span></div>
</div><!-- fragment --></li>
<li>Sector size of FAT can be adjusted. <div class="fragment"><div class="line"><span class="preprocessor">#define VIRTUALMSD_NUM_SECTORS (64)</span></div>
</div><!-- fragment --> </li>
</ul>
<h1><a class="anchor" id="autotoc_md315"></a>
Operation of VirtualMSD</h1>
<ul>
<li>Connect the USB1 on a proDK motherboard</li>
<li>Write the application to the device FLASH.</li>
<li>Run the example application by pressing once the K2(RST) button on the daughterboard.</li>
<li>Connect the USB on the daughterboard to Host-PC (Windows, Linux, OS X, Android, etc).</li>
<li>For the CDC, confirm that a new COMxx port appears at the Host-PC device manager.<ul>
<li>For MS Windows, if asked for a driver, use the <code>utilities/windows/cdc/dialog_usb.inf</code> to install it.</li>
<li><code>USB CDC serial port emulation (COMxx)</code> in Ports(COM &amp; LPT) of device manager should appear.- No special driver is required.</li>
</ul>
</li>
<li>For the Mass-Storage device confirm that a removable volume appeared in the file manager application (e.g. Windows File Explorer).</li>
<li>One file is shown at the portable storage in Host with the name 'README.txt' and is readable.</li>
<li>Create a file named <code>FW.BIN</code> (case sensitive) and copy it to the VMSD storage. Its contents will be written to the LOG partition of the device FLASH and will be accessible from the application code without any need for a file system implementation. This is the starting point for example for updating the NVMS_PART though a file write, or even performing a FW update by just drag 'n' drop the new FW to the VMSD device.</li>
<li>After creating/copy the <code>FW.BIN</code>file, eject/disconnect the USB device properly, using the O/S infrastructure (click to: "Safely Remove Hardware and Eject Media")</li>
<li>Reconnect the USB device and check if the <code>README.txt</code> file is only appeared.</li>
</ul>
<h1><a class="anchor" id="autotoc_md316"></a>
Operation of USB CDC</h1>
<ul>
<li>Refer to README.md in <a class="el" href="usb_cdc.html">usb_cdc</a> project. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 9 2022 13:50:40 for SmartSnippets DA1470x SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
